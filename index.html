<html>
	<head>
		 <link rel="stylesheet" href="main.css">
	</head>
	<body>
		<h1 id="title" >SMS Spam Detector</h1>
		<p id="instructions">Enter a text message and hit "Check" to determine whether it's spam or legit.</p>
		<div id="submission-area">
			<textarea id="input-area"></textarea>
			<div id="buttons">
				<button onclick="detectSpam()">Check</button>
				<button onclick="clearScreen()">Clear</button>
			</div>
			<p id="result"></p>
			<p id="certainty"></p>
		</div>
		<p>
			Interested in how the spam detector works? See <a href="about.html">this</a>.
		</p>

		<script>
			let resultText, inputText, certaintyText;

			function detectSpam() {
				requestPrediction(inputText.value, showResult);
			}

			function showResult(result) {
				let spam = result.prediction === "Spam"
				if (spam){
					resultText.innerHTML = "Spam!";
					resultText.style.color = "#D00000";
				} else {
					resultText.innerHTML = "Not spam";
					resultText.style.color = "#20C415";
				}
				certaintyText.innerHTML = `${(parseFloat(result.certainty) * 100).toFixed(2)}% certain`
			}

			function requestPrediction(sms, callback) {
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						callback(JSON.parse(this.responseText));
					}
				};
				xhttp.open("POST", "https://cors-anywhere.herokuapp.com/http://130.215.249.152:5000/api/isSpam", true);
				xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
				xhttp.send(JSON.stringify({"Text": sms}));
			}

			function clearScreen() {
				inputText.value = ""
				resultText.innerHTML= ""
				certaintyText.innerHTML= ""
			}

			window.onload = () => {
				inputText = document.getElementById("input-area");
				resultText = document.getElementById("result");
				certaintyText = document.getElementById("certainty");
			}
		</script>
	</body>
</html>
